<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<title>{yun:}$title{/yun}</title>
		<meta name="keywords" content="{yun:}$keywords{/yun}" />
		<meta name="description" content="{yun:}$description{/yun}" />
		<link rel="stylesheet" href="{yun:}$style{/yun}/style/css.css?v={yun:}$config.cachecode{/yun}" type="text/css" />
		<link rel="stylesheet" href="{yun:}$style{/yun}/style/yun_seach.css?v={yun:}$config.cachecode{/yun}" type="text/css" />
	</head>
	<body>
		{yun:}include file="$tplstyle/header.htm"{/yun}
		<div class="clear"></div>
		<div class="all_body">

			<form action="index.php?m=advice&c=savequestion" method="post" onsubmit="return addconsultant();" target="supportiframe">
				<div class="suggest_main">
					<div class="suggest_head">您的建议让我们每天变的更好</div>
					<div class="top_tips">用户您好，请将您的意见、想法、建议或投诉内容告诉我们，以帮助我们为全体用户提供更加优质的服务。我们将在第一时间及时回复您的反馈，如您的问题比较紧急，请致电服务热线
						：{yun:}$config.sy_freewebtel{/yun} </div>
					<div class="suggest_list_group">
						<div class="suggest_list_cell">
							<div class="list_cell_left">意见类型</div>
							<div class="list_cell_right">
								<div class="suggest_type_cell">
									<div class="suggest_type" data-code="1"><input type="hidden" name="infotype" id="ctime" value="" class="suggest_type"
										 data-code="1" />建议</div>
								</div>
								<div class="suggest_type_cell">
									<div class="suggest_type" id="suggest_type" data-code="2">意见</div>
								</div>
								<div class="suggest_type_cell">
									<div class="suggest_type" data-code="3">求助</div>
								</div>
								<div class="suggest_type_cell">
									<div class="suggest_type" data-code="4">投诉</div>
								</div>
								<div class="clear"></div>
								<input type="hidden" name="infotype" value="" />
							</div>
							<div class="clear"></div>
						</div>
						<div class="suggest_list_cell">
							<div class="list_cell_left">联系人</div>
							<div class="list_cell_right"><input type="text" class="suggest_input" name="username" id="username" placeholder="请输入您的姓名！" value="{yun:}$advice_name{/yun}" /></div>
							<div class="clear"></div>
						</div>
						<input type="hidden" name="ctime" id="ctime" value="" />
						<div class="suggest_list_cell">
							<div class="list_cell_left">联系手机</div>
							<div class="list_cell_right"><input type="text" class="suggest_input" name="telphone" id="telphone" placeholder="请输入您的手机号码以便和您沟通，您的信息仅工作人员可见！" value="{yun:}$advice_mobile{/yun}"></div>
							<div class="clear"></div>
						</div>
						{yun:}if strpos($config.code_web,"意见反馈")!==false{/yun} 
								
							{yun:}if $config.code_kind>2{/yun}
                                <div class="gtdx-captcha">

									<input type='hidden' id="verify_token"  name="verify_token" value="">
                                    <input type='hidden' id="popup-submit">	
									<input type='hidden' id="bind-submit">
                                </div>
							{yun:}else{/yun}
							<div class="suggest_list_cell">
                                <div class="list_cell_left">验证码</div>
								<div class="" style="float:left">
									<input class="suggest_input"style="width:200px" type="text" name="authcode" maxlength="6" id="txt_CheckCode" value="验证码" />
								</div>
								<div class="list_yzm" style="float:left;left:70%;margin-left:10px;">
									<img id="vcode_imgs" src="{yun:}$config.sy_weburl{/yun}/app/include/authcode.inc.php" onclick="checkCode('vcode_imgs');" />
								</div>
							</div>
                            {yun:}/if{/yun} 
                        {yun:}/if{/yun}
						{yun:}if $config.sy_msg_isopen==1 && $config.sy_msg_cert==1 && $config.sy_advice_mobilecode==1{/yun}
                      <div class="clear"></div>
						<!--手机验证码输入框-->
                        <div class="suggest_list_cell">
							<div class="list_cell_left">手机验证码</div>
							<div class="list_cell_right">
								<input type="text" class="suggest_input" style="width:200px" name="advice_code" id="advice_code" placeholder="请输入手机号验证码！" value="" />
								<a href="javascript:void(0);" class="list_cell_rightyzm" id="send_advice_msg" onclick="send_advice_msg('{yun:}url m=advice c=sendmsg{/yun}');">发送动态码</a>
							</div>
							<div class="clear"></div>
						</div>
						{yun:}/if{/yun}
						<div class="suggest_list_cell">
							<div class="list_cell_left">反馈内容</div>
							<div class="list_cell_right">
								<textarea class="suggest_area" id="content" name="content" placeholder="请详细描述您遇到的问题，有助于我们快速定位并解决问题"></textarea>
							</div>
							<div class="clear"></div>
						</div>

						
						<div class="clear"></div>
						<div class="suggest_list_cell" style="margin-top:20px;">
							<div class="list_cell_left">&nbsp;</div>
							<div class="list_cell_right">
								<input type="submit" class="btn_yellow suggest_btn" id="J_suggest_submit" value="提 交" />
							</div>
						</div>
					</div>
				</div>
			</form>
			<div class="clear"></div>

		</div>
		<div id="bind-captcha" data-id='send_advice_msg' data-type='click'></div>
		<script src="{yun:}$config.sy_weburl{/yun}/js/jquery-1.8.0.min.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
		<link href="{yun:}$config.sy_weburl{/yun}/js/layui/css/layui.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
		<script src="{yun:}$config.sy_weburl{/yun}/js/layui/layui.js?v={yun:}$config.cachecode{/yun}"></script>
		<script src="{yun:}$config.sy_weburl{/yun}/js/layui/phpyun_layer.js?v={yun:}$config.cachecode{/yun}"></script>
		<script src="{yun:}$config.sy_weburl{/yun}/js/public.js?v={yun:}$config.cachecode{/yun}" type="text/javascript"></script>
		<iframe id="supportiframe" name="supportiframe" onload="returnmessage('supportiframe');" class="dn"></iframe>
		{yun:}include file="$tplstyle/verify/verify_js.htm"{/yun}
		<script language="javascript">
			var sy_advice_mobilecode = '{yun:}$config.sy_advice_mobilecode{/yun}',
				code_web = '{yun:}$config.code_web{/yun}',
                code_kind = '{yun:}$config.code_kind{/yun}';

            var Timer;
			var smsTimer_time = 90;		//倒数 90
			var smsTimer_flag = 90;		//倒数 90
			var smsTime_speed = 1000;	//速度 1秒钟
			function exitsid(id){
				if(document.getElementById(id)){
					return true;
				}else{
					return false;
				}
			}
			//倒计时
			function smsTimer(obj){
				if (smsTimer_flag > 0) {
					$(obj).html(' ('+smsTimer_flag+'s)');
					$(obj).attr({'style':'color:#fff;font-weight: bold;'});
					smsTimer_flag--;
				}else{
					$(obj).html('重新发送');
					$(obj).attr({'style':'color:#fff;font-weight: bold;'});
					smsTimer_flag = smsTimer_time;
					clearInterval(Timer);
				}
			}

			//发送手机短信
			function send_advice_msg(url){
				var moblie = $('#telphone').val();
				
				if(moblie==''){
					layer.msg('请填写手机号！', 2, 8);return false;
				}else if(!isjsMobile(moblie)){ 
					layer.msg('手机号格式错误！', 2, 8);return false;
				}

				var verify_token	='';
				var code = '';


				var showCodeCheck = code_web.indexOf('意见反馈');
				if(showCodeCheck >= 0){		
					if(code_kind==1){
						if($("#txt_CheckCode").length>0){

							code=$.trim($("#txt_CheckCode").val());  
							if(!code || code == '验证码'){
								layer.msg('图片验证码不能为空！', 2, 8);return false;
							}	
				    	} 
					}else if(code_kind > 2){
						//改变验证需要的id
						$("#bind-captcha").attr('data-id','send_advice_msg');
						$("#bind-captcha").attr('data-type','click');
						verify_token = $('input[name="verify_token"]').val();
						
						if(verify_token ==''){

							$("#bind-submit").trigger("click");
								return false; 
						}
					}
				}
				
				if(smsTimer_time==smsTimer_flag){
					Timer = setInterval("smsTimer($('#send_advice_msg'))", smsTime_speed);
					layer.load('执行中，请稍候...',0);
					$.post(url,{moblie:moblie,code:code,verify_token:verify_token},function(data){
						layer.closeAll('loading');
						if(data){
							var res = JSON.parse(data);
							if(res.error != 1){
								clearInterval(Timer);
							}
							var icon = res.error == 1 ? 9 : 8;
							layer.msg(res.msg, 2, icon, function(){
								if(res.error != 1){
									clearInterval(Timer);
									if(code_kind == 1) {
										checkCode('vcode_imgs');
									} else if(code_kind >2) {
										$("#popup-submit").trigger("click");
									}
								}
							});
						}
					})
				}else {
					layer.msg('请勿重复发送！', 2, 8);return false;
				}
			}

			function addconsultant() {
				var infotype = $.trim($('input[name="infotype"]').val());
				var username = $.trim($("#username").val());
				var telphone = $.trim($("#telphone").val());
				var content = $.trim($("#content").val());
				var authcode = "";
				var unlock = "";
				if (infotype == '') {
					layer.msg("请选择意见类型", 2, 8);
					return false;
				}
				if (username == '') {
					layer.msg("联系人不能为空！", 2, 8);
					return false;
				}
				if (telphone == '') {
					layer.msg("手机号码不能为空！", 2, 8);
					return false;
				} else if (!isjsMobile(telphone)) {
					layer.msg("手机号码格式错误！", 2, 8);
					return false;
				}

				if(sy_advice_mobilecode=='1'){
					var advice_code = $('#advice_code').val();
					if(advice_code==''){
						layer.msg("请填写手机验证码！", 2, 8);
						return false;
					}
				}

				if (content == '') {
					layer.msg("反馈内容不能为空！", 2, 8);
					return false;
				}
				//验证码验证
				var verify_token = '';
				var authcode = '';
				if(sy_advice_mobilecode!='1'){
					var codesear=new RegExp('意见反馈');
					if(codesear.test(code_web)){
						if(code_kind==1){//数字验证
							if(exitsid("txt_CheckCode")){
								authcode=$("#txt_CheckCode").val();
								if(authcode==""||authcode=="验证码"){
									$("#show_code").show();
									$("#txt_CheckCode").focus(
										function(){
											$("#show_code").hide();
										}
									);
									return false;
								}else{
									$("#show_code").hide();
								}
							}
						}else if(code_kind > 2 ){//极验验证
							//改变验证需要的id
							$("#bind-captcha").attr('data-id','J_suggest_submit');
							$("#bind-captcha").attr('data-type','click');
							verify_token = $('input[name="verify_token"]').val();
							
							if(verify_token == ''){
								$("#bind-submit").trigger("click");
								return false;
							}
						}
					}
				}
				return true;
			}
			$(document).ready(function() {
				$("#username,#telphone,#content,#txt_CheckCode").focus(function() {
					var txValue = $(this).val();
					if (txValue == this.defaultValue) {
						$(this).val("");
					}

				});
				// 意见类型切换
				$('.suggest_type').click(function(event) {
					$('.suggest_type').each(function(index, el) {
						$(this).removeClass('selected');
					});
					$(this).addClass('selected');
					$('input[name="infotype"]').val($(this).data('code'));


				});
			});
			
		</script>
		{yun:}include file="$tplstyle/footer.htm"{/yun}
