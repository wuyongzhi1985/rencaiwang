<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link href="images/reset.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
<link href="images/system.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
<link href="images/table_form.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
<script language="javascript" type="text/javascript" src="../js/jquery-1.8.0.min.js?v={yun:}$config.cachecode{/yun}"></script>
<link href="{yun:}$config.sy_weburl{/yun}/js/layui/css/layui.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
<script src="{yun:}$config.sy_weburl{/yun}/js/layui/layui.js?v={yun:}$config.cachecode{/yun}"></script>
<script src="{yun:}$config.sy_weburl{/yun}/js/layui/phpyun_layer.js?v={yun:}$config.cachecode{/yun}"></script>
<style type="text/css">
.ui_dialog_wrap {
	visibility:hidden
}
.ui_title_icon, .ui_content, .ui_dialog_icon, .ui_btns span {
	display:inline-block;
*zoom:1;
*display:inline
}
.ui_dialog {
	text-align:left;
	position:absolute;
	top:0;
	 background:#fff;
}
.ui_dialog table {
	border:0;
	margin:0;
	border-collapse:collapse
}
.ui_dialog td {
	padding:0
}
.ui_title_icon, .ui_dialog_icon {
	vertical-align:middle;
	_font-size:0
}
.ui_title_text {
	overflow:hidden;
	cursor:default
}
.ui_close {
	display:block;
	position:absolute;
	outline:none
}
.ui_content_wrap {
	text-align:center
}
.ui_content {
	margin:10px;
	text-align:left
}
.ui_iframe .ui_content {
	margin:0;
*padding:0;
	display:block;
	height:100%;
	position:relative
}
.ui_iframe .ui_content iframe {
	border:none;
	overflow:auto
}
.ui_content_mask {
	visibility:hidden;
	width:100%;
	height:100%;
	position:absolute;
	top:0;
	left:0;
	background:#FFF;
	filter:alpha(opacity=0);
	opacity:0
}
.ui_bottom {
	position:relative
}
.ui_resize {
	position:absolute;
	right:0;
	bottom:0;
	z-index:1;
	cursor:nw-resize;
	_font-size:0
}
.ui_btns {
	text-align:right;
	white-space:nowrap
}
.ui_btns span {
	margin:5px 10px
}
.ui_btns button {
	cursor:pointer
}
* .ui_ie6_select_mask {
	position:absolute;
	top:0;
	left:0;
	z-index:-1;
	filter:alpha(opacity=0)
}
.ui_loading .ui_content_wrap {
	position:relative;
	min-width:9em;
	min-height:3.438em
}
.ui_loading .ui_btns {
	display:none
}
.ui_loading_tip {
	visibility:hidden;
	width:5em;
	height:1.2em;
	text-align:center;
	line-height:1.2em;
	position:absolute;
	top:50%;
	left:50%;
	margin:-0.6em 0 0 -2.5em
}
.ui_loading .ui_loading_tip, .ui_loading .ui_content_mask {
	visibility:visible
}
.ui_loading .ui_content_mask {
	filter:alpha(opacity=100);
	opacity:1
}
.ui_move .ui_title_text {
	cursor:move
}
.ui_page_move .ui_content_mask {
	visibility:visible
}
.ui_move_temp {
	visibility:hidden;
	position:absolute;
	cursor:move
}
.ui_move_temp div {
	height:100%
}
html>body .ui_fixed .ui_move_temp {
	position:fixed
}
html>body .ui_fixed .ui_dialog {
	position:fixed
}
* .ui_ie6_fixed {
	background:url(*) fixed
}
* .ui_ie6_fixed body {
	height:100%
}
* html .ui_fixed {
	width:100%;
	height:100%;
	position:absolute;
left:expression(documentElement.scrollLeft+documentElement.clientWidth-this.offsetWidth);
top:expression(documentElement.scrollTop+documentElement.clientHeight-this.offsetHeight)
}
* .ui_page_lock select, * .ui_page_lock .ui_ie6_select_mask {
	visibility:hidden
}
* .ui_page_lock .ui_content select {
	visibility:visible;
}
.ui_overlay {
	visibility:hidden;
	_display:none;
	position:fixed;
	top:0;
	left:0;
	width:100%;
	height:100%;
	filter:alpha(opacity=0);
	opacity:0;
	_overflow:hidden
}
.ui_lock .ui_overlay {
	visibility:visible;
	_display:block
}
.ui_overlay div {
	height:100%
}
* html body {
	margin:0
}
.ui_title{ position:relative}
</style>
<title></title>
</head>
<body class="body_ifm">
<div class="infoboxp">
<div style="margin-bottom:45px;">
  <input type="text" value="" placeholder="请输入你要搜索的关键字" id="searchKeyword" name='keyword' class="admin_new_text">
  <input type="button" value="搜索" onclick="keywordSearch()" class="admin_new_bth">
</div>
  <div class="common-form" id="menuContainer">
    {yun:}foreach item=v from=$navigation{/yun}
    <table width="100%" bgcolor="#dfdfdf">
      <tr>
        <td height="30" style="padding-left:10px"><strong>{yun:}$v.name{/yun}</strong></td>
      </tr>
      <tr>
        <td>
          {yun:}foreach item=val from=$one_menu[$v.id]{/yun}
          <table width="100%" bgcolor="#f7f7f7">
            <tr>
              <td height="30" style="padding-left:40px;"><strong>{yun:}$val.name{/yun}</strong></td>
            </tr>
            <tr>
              <td bgcolor="#fdfeff" height="30" style="padding-left:70px;">
                {yun:}foreach item=value from=$two_menu[$val.id]{/yun}
                <div style="float:left; width:100px; height:30px; line-height:30px; "> <a href="javascript:go('{yun:}$value.url{/yun}')">{yun:}$value.name{/yun}</a> </div>
                {yun:}/foreach{/yun} </td>
            </tr>
          </table>
            {yun:}/foreach{/yun}
          </td>
      </tr>
    </table>
    {yun:}/foreach{/yun} </div>
</div>
<script>
  var firstMenus = '{yun:}json_encode($navigation){/yun}',
      secondMenus = '{yun:}json_encode($one_menu){/yun}',
      thirdMenus = '{yun:}json_encode($two_menu){/yun}';

  firstMenus = JSON.parse(firstMenus)
  secondMenus = JSON.parse(secondMenus)
  thirdMenus = JSON.parse(thirdMenus)
  var originH5 = '';
function go(url) {
	window.top.document.getElementById('rightMain').src=url;
	parent.layer.closeAll();
}

$(function(){
    originH5 = $('#menuContainer').html()
})
  // 高亮显示匹配的字符串
  function highLightText(search, name){
    var r = '';
    var pre = '', after = '';
    var index = name.indexOf(search.trim())
    if (index != -1) {
        if (index == 0) {
            after = name.substring(index+search.length)
            r += '<span style="background-color: yellow">' + search + '</span>' + after;
        } else {
            pre = name.substring(0,index)
            after = name.substring(index+search.length)
            r += pre + '<span style="background-color: yellow">' + search + '</span>' + after;
        }
    } else {
        r = name;
    }
    return r;
  }

  // 根据二级分类id 获取二级分类及一级分类id
  function getFriAndSecNameBySecId(id){
    var first = {}, second = {};
    for (var i in secondMenus) {
        for (ii in secondMenus[i]) {
            if (secondMenus[i][ii].id == id) {
                second = {id: id, name: secondMenus[i][ii].name};
                for (var j in firstMenus) {
                    if (firstMenus[j].id == secondMenus[i][ii].keyid) {
                        first = {id: firstMenus[j].id, name:firstMenus[j].name};
                        break;
                    }
                }
                return {first,second}
            }
        }
    }
  }

  //地图匹配
  function keywordSearch() {
      var search = $('#searchKeyword').val();
      var h5 = '';
      var matchedThird = [];
      if (search) {
          for (var i in thirdMenus) {
              for (ii in thirdMenus[i]) {
                  if (thirdMenus[i][ii].name.indexOf(search.trim()) != -1){
                      if (!matchedThird[thirdMenus[i][ii].keyid]){
                          matchedThird[thirdMenus[i][ii].keyid] = [];
                      }
                      matchedThird[thirdMenus[i][ii].keyid].push({id: thirdMenus[i][ii].id, name: thirdMenus[i][ii].name, url: thirdMenus[i][ii].url, pid: thirdMenus[i][ii].keyid});
                  }
              }
          }
          // 循环已匹配的菜单
          var res = [];
          for(var j in matchedThird){
              var names = getFriAndSecNameBySecId(j)
              if (!res[names.first.id]) {
                  res[names.first.id] = {name: names.first.name, second:[{name: names.second.name,children:matchedThird[j]}]};
              } else {
                  res[names.first.id].second.push({name: names.second.name,children:matchedThird[j]})
              }

          }
          for (var i in res) {
              h5 += '<table width="100%" bgcolor="#dfdfdf"><tr><td height="30" style="padding-left:10px"><strong>'+highLightText(search.trim(), res[i].name)+'</strong></td></tr><tr><td>';
              for (var ii in res[i].second) {
                  h5 += '<table width="100%" bgcolor="#f7f7f7"><tr><td height="30" style="padding-left:40px;"><strong>' + highLightText(search.trim(), res[i].second[ii].name) + '</strong></td></tr><tr><td bgcolor="#fdfeff" height="30" style="padding-left:70px;">';
                  for (iii in res[i].second[ii].children) {
                      h5 += '<div style="float:left; width:100px; height:30px; line-height:30px; "><a href="javascript:go(\'' + res[i].second[ii].children[iii].url + '\')">' + highLightText(search.trim(), res[i].second[ii].children[iii].name) + '</a></div>';
                  }
                  h5 += '</td></tr></table>';
              }
              h5 += '</td></tr></table>';
          }
          $('#menuContainer').html(h5)
      } else {
          $('#menuContainer').html(originH5)
      }
  }

</script>
</body>
</html>