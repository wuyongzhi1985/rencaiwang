<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<link href="images/reset.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
	<link href="images/system.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
	<link href="images/table_form.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
	<script src="{yun:}$config.sy_weburl{/yun}/js/jquery-1.8.0.min.js?v={yun:}$config.cachecode{/yun}"></script>
	<link href="{yun:}$config.sy_weburl{/yun}/js/layui/css/layui.css?v={yun:}$config.cachecode{/yun}" rel="stylesheet" type="text/css" />
	<script src="{yun:}$config.sy_weburl{/yun}/js/layui/layui.js?v={yun:}$config.cachecode{/yun}"></script>
	<script src="{yun:}$config.sy_weburl{/yun}/js/layui/phpyun_layer.js?v={yun:}$config.cachecode{/yun}"></script>
	<script src="js/admin_public.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
	<title>后台管理</title>
</head>

<script>
	function ckemailmsg(){
		var sdate=$("#sdate").val();
		var edate=$("#edate").val(); 
		if(sdate&&edate&&toDate(edate)<toDate(sdate)){
			layer.msg("结束时间必须大于开始时间！",2,8);return false;
		}
	}
</script>
<body class="body_ifm">

<div class="infoboxp">
	<div class="tty-tishi_top">

	<div class="clear"></div>

	<div class="admin_new_search_box">
		<form action="index.php" name="myform" method="get" style="float:left" onsubmit="return ckemailmsg()">
			<input name="m" value="emailconfiglist" type="hidden"/>
			<input type="hidden" name="state" value="{yun:}$smarty.get.state{/yun}"/>
			
			<div class="admin_new_search_name">搜索类型：</div>
			
			<div class="admin_Filter_text formselect" did="dtype">
				<input type="button" {yun:}if $smarty.get.type==''||$smarty.get.type=='1'{/yun} value="邮箱"{yun:}elseif $smarty.get.type=='2'{/yun} value="发送人"{yun:}elseif $smarty.get.type=='3'{/yun} value="接收人"{yun:}elseif $smarty.get.type=='4'{/yun} value="发信邮箱"{yun:}/if{/yun} class="admin_Filter_but" id="btype">
				<input type="hidden" name="type" id="type" {yun:}if $smarty.get.type==''{/yun}value="1"{yun:}else{/yun}value="{yun:}$smarty.get.type{/yun}"{yun:}/if{/yun}/>
				
				<div class="admin_Filter_text_box" style="display:none" id="dtype">
					<ul>
						<li><a href="javascript:void(0)" onClick="formselect('1','type','邮箱')">邮箱</a></li>
						<li><a href="javascript:void(0)" onClick="formselect('2','type','发送人')">发送人</a></li>
						<li><a href="javascript:void(0)" onClick="formselect('3','type','接收人')">接收人</a></li>
						<li><a href="javascript:void(0)" onClick="formselect('4','type','发信邮箱')">发信邮箱</a></li>
					</ul>
				</div>
			</div>
			
			<input class="admin_Filter_search" type="text" name="keyword"  size="25" style="float:left">
			<div class="admin_new_search_name">时间：</div>
			<input class="admin_Filter_search" type="text" name="date" id="date" style="float:left;" value="{yun:}$smarty.get.date{/yun}"> 
			<input class="admin_Filter_bth" type="submit" name="news_search" value="检索"/>
		</form>
		{yun:}include file="admin/admin_search.htm"{/yun}
	</div>
	
	<div class="clear"></div>
	</div>

<div class="tty_table-bom">
	<div class="table-list">
    <div class="admin_table_border">
		<iframe id="supportiframe"  name="supportiframe" onload="returnmessage('supportiframe');" style="display:none"></iframe>
		<form action="index.php?m=emailconfiglist&c=del" target="supportiframe" name="myform" method="post" id='myform'>
			<table width="100%">
				<thead>
					<tr class="admin_table_top">
						<th><label for="chkall"><input type="checkbox" id='chkAll' onclick='CheckAll(this.form)'/></label></th>
						<th align="left" width="50px"> 
							{yun:}if $smarty.get.t=="id" && $smarty.get.order=="asc"{/yun} 
								<a href="{yun:}searchurl order=desc t=id m=emailconfiglist untype='order,t'{/yun}">编号<img src="images/sanj.jpg"/></a> 
							{yun:}else{/yun} 
								<a href="{yun:}searchurl order=asc t=id m=emailconfiglist untype='order,t'{/yun}">编号<img src="images/sanj2.jpg"/></a> 
							{yun:}/if{/yun} 
						</th>
						<th align="left" width="150">邮箱</th>
						<th align="left">发送人</th>
						<th align="left">接收人</th>
						<th align="left">标题</th>
						<th width="120"> 
							{yun:}if $smarty.get.t=="ctime" && $smarty.get.order=="asc"{/yun} 
								<a href="{yun:}searchurl order=desc t=ctime m=emailconfiglist untype='order,t'{/yun}">时间<img src="images/sanj.jpg"/></a> 
							{yun:}else{/yun} 
								<a href="{yun:}searchurl order=asc t=ctime m=emailconfiglist untype='order,t'{/yun}">时间<img src="images/sanj2.jpg"/></a> 
							{yun:}/if{/yun} 
						</th>
						<th width="30">状态</th>
						<th class="admin_table_th_bg">操作</th>
					</tr>
				</thead>
				
				<tbody>
				{yun:}foreach item=v key=key from=$rows{/yun}
					<tr align="center"{yun:}if ($key+1)%2=='0'{/yun}class="admin_com_td_bg"{yun:}/if{/yun} id="list{yun:}$v.id{/yun}">
						<td><input type="checkbox" value="{yun:}$v.id{/yun}"  name='del[]' onclick='unselectall()' rel="del_chk" /></td>
						<td align="left" class="td1" style="text-align:center;"><span>{yun:}$v.id{/yun}</span></td>
						<td align="left">{yun:}$v.email{/yun}</td>
						<td align="left">{yun:}$v.fname{/yun}</td>
						<td align="left">{yun:}$v.sname{/yun}</td>
						<td align="left">{yun:}$v.title{/yun}</td>
						<td>{yun:}$v.ctime|date_format:"%Y-%m-%d %H:%M"{/yun}</td>
						<td>{yun:}if $v.state==1{/yun}<font color="green">成功</font>{yun:}else{/yun}<font color="red">失败</font>{yun:}/if{/yun}</td>
						<td><a href="javascript:void(0)" onClick="layer_del('确定要删除？', 'index.php?m=emailconfiglist&c=del&id={yun:}$v.id{/yun}');"class="admin_new_c_bth admin_new_c_bth_sc">删除</a></td>
					</tr>
				{yun:}/foreach{/yun}
				<tr>
					<td align="center"><input type="checkbox" id='chkAll2' onclick='CheckAll2(this.form)' /></td>
					<td colspan="9" >
						<label for="chkAll2">全选</label>&nbsp;
						<input class="admin_button"  type="button" name="delsub" value="删除所选" onClick="return really('del[]')" />
						<input class="admin_button" type="button" name="repeat" value="失败重发" onClick="return repeatSend('del[]')" />
					</td>
				</tr>
				{yun:}if $total > $config.sy_listnum {/yun}
					<tr>
						{yun:}if $pagenum==1{/yun}
							<td colspan="3"> 从 1 到 {yun:}$config.sy_listnum {/yun} ，总共 {yun:}$total{/yun} 条</td>
						{yun:}else if $pagenum > 1 && $pagenum < $pages{/yun}
							<td colspan="3"> 从 {yun:}($pagenum-1) * $config.sy_listnum + 1{/yun} 到 {yun:}$pagenum * $config.sy_listnum{/yun} ，总共 {yun:}$total{/yun} 条</td>
						{yun:}else if $pagenum == $pages{/yun}
							<td colspan="3"> 从 {yun:}($pagenum-1) * $config.sy_listnum + 1{/yun} 到 {yun:}$total{/yun} ，总共 {yun:}$total{/yun} 条</td>
						{yun:}/if{/yun}
						<td colspan="7" class="digg">{yun:}$pagenav{/yun}</td>
					</tr>
				{yun:}/if{/yun}
				</tbody>
			</table>
			<input type="hidden" name="pytoken"  id='pytoken'  value="{yun:}$pytoken{/yun}">
		</form>
    </div>
	</div>
</div>
<script>
	layui.use(['laydate'], function(){
		var laydate = layui.laydate,
			$ = layui.$;

		laydate.render({
			elem: '#date',
			range:'~'
		});
	});
	function repeatSend(name){
		var chk_value =[];
		$('input[name="'+name+'"]:checked').each(function(){
			chk_value.push($(this).val());
		});
		if(chk_value.length==0){
			parent.layer.msg("请选择要重发的邮件！",2,8);return false;
		}else{
			var repeatcf = parent.layer.confirm("确定重新发送邮件吗？",function(){
				parent.layer.close(repeatcf);
				parent.layer.load('执行中，请稍候...',0);
				var pytoken=$("#pytoken").val();
				$.post('index.php?m=emailconfiglist&c=repeat',{pytoken:pytoken,id:chk_value},function(msg){
					parent.layer.closeAll();
					parent.layer.msg(msg,2,9,function(){location.reload();});
					return false;
				})
			});
		}
	}
</script>
</body>
</html>